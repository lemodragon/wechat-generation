<!DOCTYPE HTML>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>薰衣草Pub在线小工具</title>
    <meta name="keywords"
        content="免费在线微信对话生成器，微信对话生成器，微信朋友圈生成器，微信转账生成器，微信对话生成器无水印,无水印,微信对话生成器,红包聊天,微信聊天在线生成器,微信对话生成器在线,微信对话在线制作,微信截图生成器,微信对话框生成器" />
    <meta name="description"
        content="在线微信对话生成器是一款在线微信聊天对话制作的工具，免费在线制作微信对话生成器和转账，可以生成无水印微信转账、微信聊天、微信红包、聊天记录等截图，通过简单的设置，生成你想要的截图，是进行各种段子创作及装X的热门工具。" />
    <meta name="author" content="追风少年">
    <meta name="version" content="1.1.0">
    <link rel="shortcut icon" type="image/vnd.microsoft.icon" href="favicon.ico" />
    <script type="text/javascript">
        var _path = { images: '' }
        var page = { data: {} }
    </script>
    <link rel="stylesheet" href="static/app/css/zui.min.css">
    <link rel="stylesheet" href="static/app/css/app.css">
    <link rel="stylesheet" href="static/app/css/wallet.css">
    <script type="text/javascript" src="static/app/js/common.bundle.js"></script>
    <script type="text/javascript" src="static/app/js/cache-manager.js"></script>
    <script type="text/javascript" src="static/app/js/chat.bundle.js"></script>
    <script type="text/javascript" src="static/app/js/vue-cache-integration.js"></script>
    <script src="static/app/js/html2canvas.min.js"></script>
    <!-- gif -->
    <script src="./static/app/js/gif.js"></script>
    <script src="./static/app/js/gif.worker.js"></script>
    <!-- 添加Sortable.js库 -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <!-- 引入消息编辑与排序功能 -->
    <script src="./static/app/js/message-editor.js"></script>

    <!-- 缓存管理样式 -->
    <style>
        .cache-controls {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .cache-status-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            padding: 10px 15px;
            background: #fff;
            border: 1px solid #e9ecef;
            border-radius: 6px;
        }

        .cache-status-indicator {
            color: #28a745;
            font-size: 13px;
            font-weight: bold;
        }

        .cache-status-label {
            font-size: 13px;
            color: #6c757d;
            font-weight: 500;
        }

        .cache-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .cache-btn {
            padding: 6px 12px;
            font-size: 12px;
            border: 1px solid #007bff;
            background: #007bff;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s ease;
            min-width: 70px;
            text-align: center;
        }

        .cache-btn:hover {
            background: #0056b3;
            border-color: #0056b3;
            color: white;
            text-decoration: none;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 123, 255, 0.25);
        }

        .cache-btn.secondary {
            background: #6c757d;
            border-color: #6c757d;
        }

        .cache-btn.secondary:hover {
            background: #545b62;
            border-color: #545b62;
            box-shadow: 0 2px 4px rgba(108, 117, 125, 0.25);
        }

        .cache-btn.danger {
            background: #dc3545;
            border-color: #dc3545;
        }

        .cache-btn.danger:hover {
            background: #c82333;
            border-color: #c82333;
            box-shadow: 0 2px 4px rgba(220, 53, 69, 0.25);
        }

        .cache-btn.success {
            background: #28a745;
            border-color: #28a745;
        }

        .cache-btn.success:hover {
            background: #218838;
            border-color: #218838;
            box-shadow: 0 2px 4px rgba(40, 167, 69, 0.25);
        }

        .cache-stats {
            font-size: 11px;
            color: #6c757d;
            margin-top: 10px;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 3px solid #007bff;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .cache-title {
            font-size: 14px;
            font-weight: bold;
            color: #495057;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .cache-title::before {
            content: "💾";
            margin-right: 6px;
        }

        @media (max-width: 768px) {
            .cache-controls {
                padding: 12px;
            }

            .cache-buttons {
                gap: 8px;
            }

            .cache-btn {
                font-size: 11px;
                padding: 5px 10px;
                min-width: 60px;
            }

            .cache-status-bar {
                flex-direction: column;
                gap: 8px;
                text-align: center;
            }
        }

        /* Vue.js 模板闪烁防护样式 */
        [v-cloak] {
            display: none !important;
        }

        /* 加载状态样式 */
        .vue-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            font-size: 16px;
            color: #6c757d;
        }

        .vue-loading::before {
            content: "⏳";
            margin-right: 8px;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }
    </style>
</head>

<body>
    <div id="vueApp" class="wrapper" v-cloak>
        <div class="container-fluid page-content" style="margin-top: 10px;">
            <div role="alert" class="alert alert-warning" style="color: red;">
                声明：本站功能仅供娱乐，正式场合请勿使用，<b>严禁用于违法行为</b>，否则后果自负！
                <br>友情提示：请使用【谷歌浏览器】操作，以便获得最好的操作体验。
            </div>
            <!-- 缓存管理区域 -->
            <div class="cache-controls">
                <div class="cache-title">智能缓存管理</div>
                <div class="cache-status-bar">
                    <span class="cache-status-label">缓存状态：</span>
                    <span id="cache-status" class="cache-status-indicator">初始化中...</span>
                </div>
                <div class="cache-buttons">
                    <button class="cache-btn success" onclick="window.cacheManager.saveAll()"
                        title="立即保存所有数据">手动保存</button>
                    <button class="cache-btn" onclick="window.cacheManager.createBackup()"
                        title="创建带时间戳的备份">创建备份</button>
                    <button class="cache-btn" onclick="window.cacheManager.exportData()"
                        title="导出数据为JSON文件">导出数据</button>
                    <div class="file-input-wrapper">
                        <button class="cache-btn"
                            onclick="document.querySelector('.file-input-wrapper input[type=file]').click()"
                            title="从JSON文件导入数据">导入数据</button>
                        <input type="file" accept=".json" onchange="handleImport(this)">
                    </div>
                    <button class="cache-btn secondary" onclick="showCacheStats()" title="查看详细的缓存统计信息">缓存统计</button>
                    <button class="cache-btn danger" onclick="window.cacheManager.clearAll()"
                        title="清空所有缓存数据（谨慎使用）">清空缓存</button>
                </div>
                <div id="cache-stats" class="cache-stats" style="display: none;"></div>
            </div>
            <!--<div id="pageHeader">微信对话生成器</div>-->
            <div class="edit-content">
                <div class="tab">
                    <ul class="nav nav-tabs">
                        <li><a data-tab href="#tabContent1">外观设置</a></li>
                        <li class="active"><a data-tab href="#tabContent2">对话设置</a></li>
                        <li><a href="https://music.lvdpub.com" target="_blank">音乐</a></li>
                        <li><a href="https://demo.lvdpub.com" target="_blank">主页</a></li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane" id="tabContent1">
                            <!-- 外观设置 -->
                            <div class="view-setting">
                                <div class="view-set-item">
                                    <span>手机信号：</span>
                                    <select v-model="phone.single" class="form-control">
                                        <option value="1">1格</option>
                                        <option value="2">2格</option>
                                        <option value="3">3格</option>
                                        <option value="4" selected="selected">4格</option>
                                    </select>
                                </div>
                                <div class="view-set-item">
                                    <span>网络信号：</span>
                                    <select v-model="phone.wifi" class="form-control">
                                        <option value="1">wifi</option>
                                        <option value="2">3G</option>
                                        <option value="3">4G</option>
                                        <option value="4">5G</option>
                                    </select>
                                </div>
                                <div class="view-set-item">
                                    <span>wifi信号：</span>
                                    <select v-model="phone.wifi_single" class="form-control">
                                        <option value="1">1格</option>
                                        <option value="2">2格</option>
                                        <option value="3" selected="selected">3格</option>
                                    </select>
                                </div>
                                <div class="view-set-item">
                                    <span>手机时间：</span>
                                    <select v-model="phone.time_hour"
                                        class="form-control edit-phone-time-hour"></select>
                                    <select v-model="phone.time_mini"
                                        class="form-control edit-phone-time-mini"></select>
                                </div>
                                <div class="view-set-item">
                                    <span>充电中：</span>
                                    <label class="my-radio"><input type="radio" name="charge"
                                            v-model="phone.battery_charge" value="1"> 是</label>
                                    <label class="my-radio"><input type="radio" name="charge"
                                            v-model="phone.battery_charge" value="0" checked> 否</label>
                                </div>
                                <div class="view-set-item">
                                    <span>手机电量：</span>
                                    <input @change="onBatteryChange($event)" type="range" v-model="phone.battery_amount"
                                        min="0" max="100" value="50" />
                                    &nbsp;&nbsp;&nbsp;{{phone.battery_amount}}%
                                </div>
                                <div class="view-set-item">
                                    <span>听筒模式：</span>
                                    <label class="my-radio"><input type="radio" name="phone-ear" v-model="phone.ear"
                                            value="1"> 是</label>
                                    <label class="my-radio"><input type="radio" name="phone-ear" v-model="phone.ear"
                                            value="0" checked> 否</label>
                                </div>
                                <div class="view-set-item">
                                    <span>消息数目：</span>
                                    <input type="number" name="phone-msg-count" class="form-control"
                                        v-model.number="setting.message">
                                </div>
                                <div class="view-set-item">
                                    <span>聊天标题：</span>
                                    <input type="text" class="form-control" v-model="setting.title">
                                </div>
                                <div class="view-set-item">
                                    <span>语音模式：</span>
                                    <label class="my-radio"><input type="radio" name="phone-voice"
                                            v-model="setting.voice" value="1"> 是</label>
                                    <label class="my-radio"><input type="radio" name="phone-voice"
                                            v-model="setting.voice" value="0" checked> 否</label>
                                </div>
                                <div class="view-set-item">
                                    <span>聊天背景：</span>
                                    <a class="a-phone-set-bg" href="javascript:;" title="选择背景图">
                                        <font>+</font>
                                        <img class="img-phone-set-bg" :src="setting.background" />
                                        <input @change="setBackground($event)" type="file" />
                                        <span @click="deleteBackground" v-if="setting.background != ''">x</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                        <!-- 对话设置 -->
                        <div class="tab-pane active" id="tabContent2">
                            <div class="dialog-user">
                                <div class="dialog-user-title">编辑和选择用户（<font>第一个用户默认是自己，点击头像可更换头像哦</font>）</div>
                                <div class="dialog-user-items">
                                    <div v-for="(user, index) in users" class="dialog-user-item">
                                        <div class="dialog-user-face">
                                            <a class="dialog-user-face-a" href="javascript:;">
                                                <input @change="setUserImage($event, index)" type="file"
                                                    placeholder="点击更换头像">
                                                <i :style="'background-image: url(' + user.image + ')'"></i>
                                            </a>
                                            <input type="text" v-model="user.name" />
                                            <a @click="selectUser(index)"
                                                :class="['dialog-user-select', {'dialog-user-selected':user.selected}]">选择用户</a>
                                            <a v-if="!user.is_me" @click="delUser(index)" class="dialog-user-delete"
                                                title="删除用户">x</a>
                                        </div>
                                    </div>
                                    <div class="dialog-user-item">
                                        <a @click="addUser" class="dialog-user-item-add" href="javascript:;"
                                            title="添加用户">+</a>
                                    </div>
                                </div>

                                <div class="dialog-user-content-title">发送人：{{getSender()}}</div>
                                <div class="dialog-user-content">
                                    <div class="dialog-user-content-panel">
                                        <textarea v-model="setting.dialog_content"
                                            class="edit-dialog-text form-control"></textarea>
                                    </div>
                                    <div class="view-setting view-setting2">
                                        <div class="view-set-item">
                                            <span>红包或转账金额：</span>
                                            <input v-model.number="setting.dialog_money" type="number"
                                                class="form-control">
                                        </div>
                                        <div class="view-set-item">
                                            <span>添加聊天时间：</span>
                                            <select v-model="setting.date_year"
                                                class="form-control edit-phone-time-year">
                                                <option value="">-</option>
                                            </select>
                                            <select v-model="setting.date_month"
                                                class="form-control edit-phone-time-month" style="width: 60px;">
                                                <option value="">-</option>
                                            </select>
                                            <select v-model="setting.date_day" class="form-control edit-phone-time-day"
                                                style="width: 60px;">
                                                <option value="">-</option>
                                            </select>
                                            <select v-model="setting.date_xinqi" class="form-control">
                                                <option value="">-</option>
                                                <option value="星期一">星期一</option>
                                                <option value="星期二">星期二</option>
                                                <option value="星期三">星期三</option>
                                                <option value="星期四">星期四</option>
                                                <option value="星期五">星期五</option>
                                                <option value="星期六">星期六</option>
                                                <option value="星期日">星期日</option>
                                            </select>
                                            <select v-model="setting.date_shiduan" class="form-control"
                                                style="width: 60px;">
                                                <option value="">-</option>
                                                <option value="上午">上午</option>
                                                <option value="下午">下午</option>
                                                <option value="凌晨">凌晨</option>
                                            </select>
                                            <select v-model="setting.date_hour"
                                                class="form-control edit-phone-time-hour" style="width: 60px;">

                                            </select>
                                            ：
                                            <select v-model="setting.date_min" class="form-control edit-phone-time-mini"
                                                style="width: 60px;">

                                            </select>
                                        </div>
                                        <div class="view-set-item">
                                            <span>语音时间：</span>
                                            <input v-model.number="setting.dialog_voice" type="number"
                                                class="form-control">
                                            &nbsp;&nbsp;&nbsp;
                                            <label>是否已读：</label>
                                            <label class="my-radio"><input type="radio"
                                                    v-model="setting.dialog_voice_isread" value="1" checked>
                                                是</label>
                                            <label class="my-radio"><input type="radio"
                                                    v-model="setting.dialog_voice_isread" value="0"> 否</label>
                                        </div>
                                        <div class="view-set-item">
                                            <span>红包备注：</span>
                                            <input v-model="setting.dialog_repacket_remark" type="text"
                                                class="form-control">
                                        </div>
                                        <div class="view-set-item">
                                            <span>转账备注：</span>
                                            <input v-model="setting.dialog_trans_remark" type="text"
                                                class="form-control">
                                        </div>
                                    </div>
                                    <div class="btn-groups">
                                        <div class="btn-group">
                                            <button @click="addTextDialog" class="btn btn-success">添加文字对话</button>
                                            <button @click="addNoticeDialog" class="btn btn-primary">添加时间</button>
                                            <button class="btn btn-primary btn-send-image">添加图片对话<input
                                                    @change="addImageDialog($event)" type="file"></button>

                                        </div>
                                        <div class="btn-group">
                                            <button @click="addVoiceDialog" class="btn btn-primary">添加语音对话</button>
                                            <button @click="addRedpacketDialog" class="btn btn-primary">添加红包对话</button>
                                            <button @click="addTransferDialog" class="btn btn-primary">添加转账对话</button>
                                        </div>
                                    </div>
                                    <button class="btn-clear" @click="cleanDialogs" href="javascript:;">清空聊天内容</button>
                                    <button class="btn-clear" @click="save" href="javascript:;">生成图片</button>
                                    <button class="btn-clear" id="downGif">生成GIF</button>
                                    <div style="margin-top: 20px;">
                                        <p>生成视频功能: 点击下方的"开始录制"按钮即可录制视频（停止录制后会在右侧生成视频，您可以下载该视频）</p>
                                        <p>生成GIF图片: 点击下方的"开始录制"按钮即可生成动态图片（停止录制后点击上方的"生成GIF"按钮下载GIF图片）</p>
                                        <p>为了尊重原作者的权益，更多的高级功能，请询问原作者，这里只是免费版的体验用途，点击跳转原作者链接<a
                                                href='https://gitee.com/lifeixue/weixin-chat'>原作者地址</a></p>
                                    </div>
                                    <button class="btn-recording" id="btn-start-recording">开始录制</button>
                                    <button class="btn-recording" id="btn-stop-recording" disabled>停止录制</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- phone -->
                <div class="phone-wrap" id="element-to-record">
                    <div class="phone-content">
                        <div id="phone" class="phone">
                            <div class="phone-top">
                                <div class="phone-bar">
                                    <div class="phone-time">{{phone.time_hour}}:{{phone.time_mini}}</div>
                                    <div
                                        :class="['phone-sigle', {'phone-sigle-v1':phone.single == 1}, {'phone-sigle-v2':phone.single == 2}, {'phone-sigle-v3':phone.single == 3}, {'phone-sigle-v4':phone.single == 4}]">
                                        信号</div>
                                    <div
                                        :class="['phone-wifi', {'phone-wifi-v2':phone.wifi > 1}, phone.wifi == 1 ? 'phone-wifi-s' + phone.wifi_single : '']">
                                        <template v-if="phone.wifi == 1">
                                            wifi
                                        </template>
                                        <template v-else-if="phone.wifi == 2">
                                            3G
                                        </template>
                                        <template v-else-if="phone.wifi == 3">
                                            4G
                                        </template>
                                        <template v-else-if="phone.wifi == 4">
                                            5G
                                        </template>
                                    </div>
                                    <div :class="['phone-battery', {'phone-battery-charge':phone.battery_charge == 1}]">
                                        <span>
                                            <font :style="[{width: phone.battery_amount + '%'}]">电量</font>
                                            <i></i>
                                        </span>
                                    </div>
                                </div>
                                <div class="phone-nav">
                                    <div class="phone-nav-left">
                                        <div class="phone-nav-back">返回</div>
                                        <span v-if="setting.message && setting.message > 0">{{setting.message}}</span>
                                    </div>
                                    <div class="phone-nav-center">
                                        <span>
                                            <font>{{setting.title}}</font>
                                            <i v-if="phone.ear == 1"></i>
                                        </span>
                                    </div>
                                    <div class="phone-nav-right">
                                        <div class="phone-nav-more">更多</div>
                                    </div>
                                </div>
                            </div>

                            <div class="phone-bg">
                                <img @load="onBackgroundLoad($event)" :src="setting.background" />
                            </div>

                            <div class="phone-water"></div>

                            <div class="phone-body">
                                <div class="wechat-content" id="sortableList">
                                    <template v-for="(dialog, index) in dialogs">
                                        <div :class="['wechat-dialog', {'wechat-dialog-right':dialog.is_me}]">
                                            <div v-if="dialog.type != 'notice'" class="wechat-dialog-face">
                                                <img :src="getUserById(dialog.user_id).image" />
                                            </div>

                                            <template v-if="dialog.type == 'text'">
                                                <div class="wechat-dialog-text" v-if="!dialog.isEditing">
                                                    {{dialog.content}}</div>
                                                <div class="wechat-dialog-text wechat-dialog-editing"
                                                    v-if="dialog.isEditing">
                                                    <textarea v-model="dialog.editContent"
                                                        class="edit-message-textarea"></textarea>
                                                    <div class="edit-message-actions">
                                                        <button @click="saveEditedDialog(index)"
                                                            class="btn-edit-save">保存</button>
                                                        <button @click="cancelEditDialog(index)"
                                                            class="btn-edit-cancel">取消</button>
                                                    </div>
                                                </div>
                                            </template>

                                            <template v-if="dialog.type == 'image'">
                                                <div
                                                    :class="['wechat-dialog-text', 'wechat-dialog-image', {'wechat-dialog-image-noborder':setting.background != ''}]">
                                                    <img :src="dialog.image">
                                                </div>
                                            </template>

                                            <template v-if="dialog.type == 'voice'">
                                                <div class="wechat-dialog-text wechat-dialog-voice">
                                                    <div v-if="dialog.is_me"
                                                        :style="{width: getVoiceLength(dialog.time) + 'px'}"></div>
                                                    <span v-if="dialog.is_me">{{dialog.time}}"</span>
                                                    <i></i>
                                                    <span v-if="!dialog.is_me">{{dialog.time}}"</span>
                                                    <div v-if="!dialog.is_me"
                                                        :style="{width: getVoiceLength(dialog.time) + 'px'}"></div>
                                                    <em v-if="!dialog.is_me && dialog.isread == '0'"></em>
                                                </div>
                                            </template>

                                            <template v-if="dialog.type == 'notice'">
                                                <div class="wechat-dialog-notice">
                                                    <span
                                                        :class="[{'wechat-dialog-notice-has-bg':setting.background != ''},{'wechat-dialog-notice-system':dialog.is_system}]"
                                                        v-html="dialog.content"></span>
                                                </div>
                                            </template>

                                            <template v-if="dialog.type == 'transfer' || dialog.type == 'redpacket'">
                                                <div
                                                    :class="['wechat-dialog-text', 'wechat-dialog-trans', {'wechat-dialog-trans-get':dialog.is_get}]">
                                                    <div
                                                        :class="['wechat-dialog-trans-content', {'wechat-dialog-redp-content':dialog.type == 'redpacket'}]">
                                                        <i></i>
                                                        <div>
                                                            <span
                                                                v-if="dialog.type == 'transfer'">¥{{moneyFormat(dialog.money,
                                                                2, '', false)}}</span>
                                                            <font v-if="dialog.type == 'transfer'">{{dialog.remark}}
                                                            </font>
                                                            <span
                                                                v-if="dialog.type == 'redpacket'">{{dialog.remark}}</span>
                                                            <font v-if="dialog.type == 'redpacket' && dialog.is_get">
                                                                已领取</font>
                                                        </div>
                                                    </div>
                                                    <div class="wechat-dialog-trans-bottom">
                                                        <span v-if="dialog.type == 'transfer'">微信转账</span>
                                                        <span v-if="dialog.type == 'redpacket'">微信红包</span>
                                                    </div>
                                                </div>
                                            </template>

                                            <a @click="deleteDialog(index)" class="a-wechat-dialog-del"
                                                href="javascript:;" title="删除对话">X</a>

                                            <a v-if="dialog.type == 'text' && !dialog.isEditing"
                                                @click="editDialog(index)" class="a-wechat-dialog-edit"
                                                href="javascript:;" title="编辑对话">✎</a>

                                            <div v-if="!dialog.is_get && dialog.type == 'redpacket'"
                                                class="a-wechat-dialog-menu">
                                                <a @click="redpacketGet(index)">领取</a>
                                            </div>
                                            <div v-if="!dialog.is_get && dialog.type == 'transfer'"
                                                class="a-wechat-dialog-menu">
                                                <a @click="transferGet(index)">领取</a>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>

                            <div class="phone-bottom">
                                <div class="phone-bottom-chat">
                                    <div class="wechat-bottom">
                                        <div
                                            :class="['wechat-bottom-icon', 'wechat-voice-icon', {'wechat-voice-say-icon':setting.voice == 1}]">
                                            语音</div>
                                        <div :class="['wechat-input', {'wechat-input-say':setting.voice == 1}]">
                                            <template v-if="setting.voice == 1">按住 说话</template>
                                            <template v-else>输入框</template>
                                        </div>
                                        <div class="wechat-bottom-icon wechat-emoji-icon">表情</div>
                                        <div class="wechat-bottom-icon wechat-more-icon">更多功能</div>
                                    </div>
                                </div>
                                <div class="phone-bottom-bar">
                                    <i>返回桌面</i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="display: none; margin-left: 10px;">
                    <video controls autoplay playsinline id="preview-video"></video>
                </div>
                <canvas id="background-canvas" style="position: absolute; left: -99999px;"></canvas>
            </div>
        </div>
        <!-- <canvas id="background-canvas" style="position: absolute; left: -99999px;"></canvas> -->
    </div>
    <a style="display: none;" id="lightBoxToggle" href="javascript:;" data-width="300"
        data-caption="右击图片，点击图片另存为即可下载图片">生成图片</a>

    <!-- 缓存管理脚本 -->
    <script>
        /**
         * 处理文件导入
         */
        function handleImport(input) {
            const file = input.files[0];
            if (file) {
                // 显示导入开始提示
                if (window.cacheManager) {
                    window.cacheManager.updateCacheStatus('开始导入数据...');
                    window.cacheManager.showNotification('正在读取文件，请稍候...', 'info');
                }

                window.cacheManager.importData(file).then(() => {
                    console.log('数据导入成功');
                }).catch((error) => {
                    console.error('数据导入失败:', error);
                    if (window.cacheManager) {
                        window.cacheManager.updateCacheStatus('导入失败');
                        window.cacheManager.showNotification('数据导入失败：' + error.message, 'error');
                    }
                });
                input.value = ''; // 清空输入，允许重复选择同一文件
            }
        }

        /**
         * 显示/隐藏缓存统计信息
         */
        function showCacheStats() {
            const statsElement = document.getElementById('cache-stats');
            const isVisible = statsElement.style.display !== 'none';

            if (isVisible) {
                statsElement.style.display = 'none';
            } else {
                const stats = window.cacheManager.getCacheStats();
                statsElement.innerHTML = `
                    <strong>📊 缓存统计信息</strong><br>
                    • 设置缓存: ${stats.setting ? '✅ 已保存' : '❌ 未保存'}<br>
                    • 用户数量: ${stats.users} 个<br>
                    • 对话数量: ${stats.dialogs} 条<br>
                    • 备份数量: ${stats.backupCount} 个<br>
                    • 最后保存: ${stats.lastSave || '未知'}
                `;
                statsElement.style.display = 'block';
            }
        }

        /**
         * 页面加载后的初始化
         */
        document.addEventListener('DOMContentLoaded', function () {
            // 等待缓存管理器初始化完成
            setTimeout(() => {
                if (window.cacheManager) {
                    // 显示初始统计信息
                    showCacheStats();
                    setTimeout(() => {
                        document.getElementById('cache-stats').style.display = 'none';
                    }, 3000);

                    // 初始化状态显示
                    window.cacheManager.updateCacheStatus('缓存系统已就绪');
                }
            }, 1500);
        });

        /**
         * 扩展Vue应用以集成缓存管理器
         */
        document.addEventListener('DOMContentLoaded', function () {
            setTimeout(function () {
                if (window.vueApp && window.cacheManager) {
                    // 保存Vue应用实例的引用以便缓存管理器访问
                    window.cacheManager.vueApp = window.vueApp;
                    console.log('Vue应用与缓存管理器集成完成');
                }
            }, 2000);
        });

        /**
         * 全局错误处理
         */
        window.addEventListener('error', function (event) {
            console.error('页面错误:', event.error);
            if (window.cacheManager) {
                window.cacheManager.updateCacheStatus('发生错误，已自动保存');
                window.cacheManager.saveAll();
            }
        });

        /**
         * 页面可见性变化处理
         */
        document.addEventListener('visibilitychange', function () {
            if (window.cacheManager) {
                if (document.hidden) {
                    window.cacheManager.updateCacheStatus('页面隐藏，已保存');
                } else {
                    window.cacheManager.updateCacheStatus('页面激活，缓存正常');
                }
            }
        });
    </script>
</body>

</html>